# Translateme

Chrome-расширение и веб-платформа для **перевода видео в реальном времени**: субтитры, озвучка, конспект в PDF и учёт минут через БД.

---

## Возможности расширения

### Перевод и озвучка в реальном времени
- **Живой перевод** — речь из вкладки (YouTube, Vimeo, Coursera, любой сайт с видео) распознаётся и переводится на лету.
- **Озвучка (TTS)** — переведённый текст озвучивается голосом OpenAI (мужской / женский / нейтральный). Можно приглушить оригинал и слушать только перевод.
- **Регулировка громкости** — отдельный слайдер громкости оригинала и перевода.

### Субтитры
- Субтитры поверх видео, в том числе в **полноэкранном режиме** и внутри **iframe** (Vimeo, встроенные плееры).
- Отображение внизу по центру; поддержка любых сайтов с видео.

### Конспект видео (Summary PDF)
- Накопление переведённого текста за сессию.
- Кнопка **Summary PDF** — генерация краткого конспекта (1–2 страницы) через GPT и **скачивание PDF** с поддержкой кириллицы и любого языка.

### Учёт минут и БД
- Баланс минут запрашивается с бэкенда (API на Vercel), а не только из локального хранилища.
- Гости: лимит бесплатных минут; залогиненные пользователи — платные минуты из БД (Supabase).
- Списание минут при записи перевода (POST на `/api/minutes`).

### Плавающая панель (OPEN_UI)
- По клику на иконку расширения на странице открывается плавающая панель с iframe настроек (тот же popup), прижатая к правому краю экрана.

---

## Стили перевода

В настройках можно выбрать **стиль перевода** — он задаёт системный промпт для модели (GPT-4o-mini):

| Стиль | Описание |
|-------|----------|
| **Default (Natural Speech)** | Профессиональный синхронный перевод: естественная речь, смысл важнее буквальности, грамматика целевого языка. |
| **Kids** | Простой язык, сказочный тон, для детей ~5 лет. |
| **Kabbalah** | Строго технический перевод для каббалистических текстов: термины (иврит/арамей) транслитерируются, остальное переводится без интерпретаций. |
| **Scientific** | Технический/научный стиль: точные термины, формальный язык, без упрощений. |
| **Children** | Вариант «для детей», простые формулировки. |

В коде также предусмотрены стили **Slang** (молодёжный сленг, мемы) и **Poetic** (поэтичный перевод) — при необходимости их можно включить в UI.

---

## Языки

### Популярные и быстрые (Deepgram Nova-3, WebSocket)
Распознавание в реальном времени с минимальной задержкой:

- **Английский** (US, UK, Australia, India, New Zealand)  
- **Русский, украинский**  
- **Немецкий, французский, испанский** (в т.ч. LatAm), **итальянский, португальский** (и бразильский)  
- **Китайский** (упрощённый и традиционный), **японский, корейский**  
- **Хинди, турецкий, польский, голландский, шведский, финский, норвежский, датский**  
- **Вьетнамский, тайский, индонезийский, малайский**  
- **Греческий, чешский, венгерский, румынский, болгарский, хорватский, словенский, словацкий**  
- **Эстонский, латышский, литовский**  
- **Каннада, маратхи, тамильский, телугу**  
- **Каталанский**  
- **Авто (default)** — язык определяется моделью.

### Сложные / семитские (OpenAI Whisper, batch)
Для лучшего качества распознавания иврита, арабского и персидского используется **Whisper** (пакетная обработка по интервалам), а не потоковый WebSocket:

- **Иврит (he)**  
- **Арабский (ar)**  
- **Персидский (fa)**  

Конфиг: `extension/langConfig.js` — для `he`, `ar`, `fa` заданы `model: 'whisper-large'` и интервал (например 10000 ms).

---

## Технологии (скорость и точность)

- **Распознавание речи (STT)**  
  - **Deepgram Nova-3** по WebSocket — основной режим: самая быстрая потоковая распознавание, низкая задержка.  
  - **OpenAI Whisper** — для иврита, арабского, персидского, где потоковые модели слабее.

- **Перевод**  
  - **OpenAI GPT-4o-mini** — быстрая и дешёвая модель, подходит для живого перевода и разных стилей (в т.ч. Kabbalah, Technical, Kids).

- **Озвучка (TTS)**  
  - **OpenAI TTS-1**, голоса: **Nova** (нейтральный), **Shimmer** (женский), **Onyx** (мужский), **Alloy** (auto).

- **Аудио в расширении**  
  - **Audio Worklet API** (PCM 16 kHz, моно) для передачи потока в Deepgram без лишних задержек.  
  - Tab capture → AudioContext → Worklet → WebSocket.

- **Мониторинг**  
  - **Opik (Comet)** — трейсы переводов, STT и TTS (duration, input/output length и т.д.), UUID v7.

---

## Стек проекта

- **Расширение**: Chrome Manifest V3, Vanilla JS, Audio Worklet, Offscreen Document.
- **Бэкенд/минуты**: Next.js API Routes, Supabase (пользователи, минуты), Stripe (подписки).
- **Фронт сайта**: Next.js, React, i18n, PWA.

---

## Установка расширения

1. Клонировать репозиторий.
2. Создать `extension/secrets.js` (по образцу `secrets.example.js`): ключи OpenAI, Deepgram, при необходимости Opik.
3. В Chrome: `chrome://extensions/` → «Режим разработчика» → «Загрузить распакованное расширение» → выбрать папку `extension/`.

Расширение обращается к API минут на `API_BASE_URL` (в коде — `https://translateme-app.vercel.app`). Для локальной разработки можно подменить URL в `extension/background.js`.

---

## Конфигурация языков и голосов

- **Языки**: `extension/langConfig.js` — `LANGUAGE_CONFIG` (коды языков, модель nova-3 или whisper-large, интервал).
- **Голоса TTS**: в том же файле — `VOICE_CONFIG` (male, female, neutral, auto → имена голосов OpenAI).
- **Промпты стилей перевода**: `extension/offscreen.js`, объект `prompts` внутри функции перевода (DEFAULT, KIDS, KABBALAH, TECHNICAL, SLANG, POETIC).

---

## Лицензия

© 2026 Translateme. Все права защищены.
